{"version":3,"file":"rules.min.js","sources":["../src/rules.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Rules AMD module for Integration Hub.\n *\n * Handles rule form interactions: service-type label toggle, add/cancel form,\n * and payload template preview via AJAX.\n *\n * @module     local_integrationhub/rules\n * @copyright  2026 Integration Hub Contributors\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification'\n    ],\n    function(\n        $,\n        Ajax,\n        Notification\n    ) {\n\n        return {\n            init: function(serviceTypes) {\n\n                try {\n                    var formContainer = $('#ih-rule-form');\n                    var btnAdd = $('#ih-btn-add');\n                    var btnCancel = $('#ih-btn-cancel');\n                    var btnPreview = $('#ih-btn-preview');\n                    var templateField = $('#ih-template');\n                    var serviceField = $('#ih-serviceid');\n                    var endpointField = $('#ih-endpoint');\n                    var endpointLabel =\n                        $('label[for=\"ih-endpoint\"]');\n                    var methodContainer =\n                        $('#ih-method-container');\n\n                    var updateEndpointLabel =\n                        function() {\n\n                            var svcId =\n                                serviceField.val();\n\n                            var type =\n                                serviceTypes[svcId] ||\n                                'rest';\n\n                            if (type === 'amqp') {\n                                endpointLabel.text(\n                                    'Queue Name / Routing Key'\n                                );\n\n                                endpointField.attr(\n                                    'placeholder',\n                                    'e.g. user_sync_queue'\n                                );\n\n                                methodContainer.addClass(\n                                    'd-none'\n                                );\n                            } else if (type === 'soap') {\n                                endpointLabel.text(\n                                    'SOAP Action / Method'\n                                );\n\n                                endpointField.attr(\n                                    'placeholder',\n                                    'e.g. CreateUser'\n                                );\n\n                                methodContainer.addClass(\n                                    'd-none'\n                                );\n                            } else {\n                                endpointLabel.text(\n                                    'Endpoint Path'\n                                );\n\n                                endpointField.attr(\n                                    'placeholder',\n                                    'e.g. /api/v1/users'\n                                );\n\n                                methodContainer.removeClass(\n                                    'd-none'\n                                );\n                            }\n                        };\n\n                    if (serviceField.length) {\n                        serviceField.on(\n                            'change',\n                            updateEndpointLabel\n                        );\n\n                        updateEndpointLabel();\n                    }\n\n                    if (btnAdd.length) {\n                        btnAdd.on('click', function() {\n\n                            $('#ih-ruleid').val('0');\n                            $('#ih-form')[0].reset();\n\n                            formContainer.removeClass(\n                                'd-none'\n                            );\n\n                            btnAdd.addClass('d-none');\n                        });\n                    }\n\n                    if (btnCancel.length) {\n                        btnCancel.on('click', function() {\n\n                            formContainer.addClass(\n                                'd-none'\n                            );\n\n                            btnAdd.removeClass('d-none');\n                        });\n                    }\n\n                    if (btnPreview.length) {\n                        btnPreview.on('click', function(e) {\n                            e.preventDefault();\n\n                            var template = templateField.val();\n                            if (!template) {\n                                Notification.alert('Error', 'Please enter a template first.', 'OK');\n                                return;\n                            }\n\n                            var eventNameField = $('#ih-eventname');\n                            var eventname = eventNameField.length ? eventNameField.val() : '';\n\n                            var promises = Ajax.call([{\n                                methodname: 'local_integrationhub_preview_payload',\n                                args: {\n                                    template: template,\n                                    eventname: eventname\n                                }\n                            }]);\n\n                            promises[0].done(function(response) {\n                                if (response.success) {\n                                    var preStyle = 'text-align: left; background: #f8f9fa; ' +\n                                        'padding: 10px; border: 1px solid #ddd;';\n                                    var content = '<pre style=\"' + preStyle + '\">' +\n                                        response.payload + '</pre>';\n                                    Notification.alert('Payload Preview', content, 'OK');\n                                } else {\n                                    Notification.alert('Error', response.error || 'Failed to preview payload.', 'OK');\n                                }\n                            }).fail(Notification.exception);\n                        });\n                    }\n                } catch (e) {\n                    Notification.exception(e);\n                }\n            }\n        };\n    }\n);\n"],"names":["define","$","Ajax","Notification","init","serviceTypes","formContainer","btnAdd","btnCancel","btnPreview","templateField","serviceField","endpointField","endpointLabel","methodContainer","updateEndpointLabel","svcId","val","type","text","attr","addClass","removeClass","length","on","reset","e","preventDefault","template","eventNameField","eventname","call","methodname","args","done","response","success","content","payload","alert","error","fail","exception"],"mappings":";;;;;;;;;;AA0BAA,oCACI,CACI,SACA,YACA,sBAEJ,SACIC,EACAC,KACAC,oBAGO,CACHC,KAAM,SAASC,sBAGHC,cAAgBL,EAAE,iBAClBM,OAASN,EAAE,eACXO,UAAYP,EAAE,kBACdQ,WAAaR,EAAE,mBACfS,cAAgBT,EAAE,gBAClBU,aAAeV,EAAE,iBACjBW,cAAgBX,EAAE,gBAClBY,cACAZ,EAAE,4BACFa,gBACAb,EAAE,wBAEFc,oBACA,eAEQC,MACAL,aAAaM,MAEbC,KACAb,aAAaW,QACb,OAES,SAATE,MACAL,cAAcM,KACV,4BAGJP,cAAcQ,KACV,cACA,wBAGJN,gBAAgBO,SACZ,WAEY,SAATH,MACPL,cAAcM,KACV,wBAGJP,cAAcQ,KACV,cACA,mBAGJN,gBAAgBO,SACZ,YAGJR,cAAcM,KACV,iBAGJP,cAAcQ,KACV,cACA,sBAGJN,gBAAgBQ,YACZ,YAKZX,aAAaY,SACbZ,aAAaa,GACT,SACAT,qBAGJA,uBAGAR,OAAOgB,QACPhB,OAAOiB,GAAG,SAAS,WAEfvB,EAAE,cAAcgB,IAAI,KACpBhB,EAAE,YAAY,GAAGwB,QAEjBnB,cAAcgB,YACV,UAGJf,OAAOc,SAAS,aAIpBb,UAAUe,QACVf,UAAUgB,GAAG,SAAS,WAElBlB,cAAce,SACV,UAGJd,OAAOe,YAAY,aAIvBb,WAAWc,QACXd,WAAWe,GAAG,SAAS,SAASE,GAC5BA,EAAEC,qBAEEC,SAAWlB,cAAcO,SACxBW,cAKDC,eAAiB5B,EAAE,iBACnB6B,UAAYD,eAAeN,OAASM,eAAeZ,MAAQ,GAEhDf,KAAK6B,KAAK,CAAC,CACtBC,WAAY,uCACZC,KAAM,CACFL,SAAUA,SACVE,UAAWA,cAIV,GAAGI,MAAK,SAASC,aAClBA,SAASC,QAAS,KAGdC,QAAU,8FACVF,SAASG,QAAU,SACvBnC,aAAaoC,MAAM,kBAAmBF,QAAS,WAE/ClC,aAAaoC,MAAM,QAASJ,SAASK,OAAS,6BAA8B,SAEjFC,KAAKtC,aAAauC,gBAzBjBvC,aAAaoC,MAAM,QAAS,iCAAkC,SA4B5E,MAAOb,GACLvB,aAAauC,UAAUhB"}