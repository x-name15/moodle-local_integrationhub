/**
 * Dashboard AMD module for Integration Hub.
 *
 * Handles chart rendering (Chart.js) and service-form UI interactions
 * (show/hide AMQP builder, type-toggle, AMQP URL sync).
 *
 * @module     local_integrationhub/dashboard
 * @copyright  2026 Integration Hub Contributors
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_integrationhub/dashboard",["core/notification"],(function(Notification){return{init:function(data,strings){try{const form=document.getElementById("ih-service-form"),btnAdd=document.getElementById("ih-btn-add"),btnCancel=document.getElementById("ih-btn-cancel");btnAdd&&form&&btnAdd.addEventListener("click",(function(){const svcId=document.getElementById("ih-serviceid"),ihForm=document.getElementById("ih-form");svcId&&(svcId.value="0"),ihForm&&ihForm.reset(),form.classList.remove("d-none"),btnAdd.classList.add("d-none");const nameField=document.getElementById("ih-name");nameField&&nameField.focus()})),btnCancel&&form&&btnCancel.addEventListener("click",(function(){form.classList.add("d-none"),btnAdd&&btnAdd.classList.remove("d-none")}));const typeField=document.getElementById("ih-type"),urlField=document.getElementById("ih-base_url"),urlHelp=document.getElementById("ih-base_url-help"),amqpBuilder=document.getElementById("ih-amqp-builder"),baseUrlContainer=document.querySelector(".ih-base-url-container"),authTypeContainer=document.getElementById("ih-auth_type")?document.getElementById("ih-auth_type").closest(".col-md-6"):null,responseQueueContainer=document.getElementById("ih-response_queue")?document.getElementById("ih-response_queue").closest(".col-md-6"):null,updateUiForType=function(){"amqp"===(typeField.value||"rest")?(urlHelp.textContent=strings.url_help_amqp,amqpBuilder&&amqpBuilder.classList.remove("d-none"),baseUrlContainer&&baseUrlContainer.classList.add("d-none"),authTypeContainer&&authTypeContainer.classList.add("d-none"),responseQueueContainer&&responseQueueContainer.classList.add("d-none")):(urlField.value&&(urlField.value.startsWith("amqp://")||urlField.value.startsWith("amqps://"))&&(urlField.value=""),urlHelp.textContent=strings.url_help_rest,amqpBuilder&&amqpBuilder.classList.add("d-none"),baseUrlContainer&&baseUrlContainer.classList.remove("d-none"),authTypeContainer&&authTypeContainer.classList.remove("d-none"),responseQueueContainer&&responseQueueContainer.classList.remove("d-none"))},syncAmqpUrl=function(){const host=document.getElementById("ih-amqp_host").value||"localhost",port=document.getElementById("ih-amqp_port").value||"5672",user=document.getElementById("ih-amqp_user").value||"guest",pass=document.getElementById("ih-amqp_pass").value||"guest";let vhost=document.getElementById("ih-amqp_vhost").value||"/";const exchange=document.getElementById("ih-amqp_exchange").value,routingKey=document.getElementById("ih-amqp_routing_key").value,queueDeclare=document.getElementById("ih-amqp_queue_declare").value,dlq=document.getElementById("ih-amqp_dlq").value;"/"!==vhost&&vhost.startsWith("/")&&(vhost=vhost.substring(1));const eUser=encodeURIComponent(user),ePass=encodeURIComponent(pass),eHost=encodeURIComponent(host);let eVhost="";"/"!==vhost&&(eVhost=encodeURIComponent(vhost));let url=("5671"===port?"amqps":"amqp")+"://"+eUser+":"+ePass+"@"+eHost+":"+port+"/"+eVhost;const params=[];exchange&&params.push("exchange="+encodeURIComponent(exchange)),routingKey&&params.push("routing_key="+encodeURIComponent(routingKey)),queueDeclare&&params.push("queue_declare="+encodeURIComponent(queueDeclare)),dlq&&params.push("dlq="+encodeURIComponent(dlq)),params.length>0&&(url+="?"+params.join("&")),urlField&&(urlField.value=url)};typeField&&urlHelp&&(typeField.addEventListener("change",updateUiForType),typeField.addEventListener("change",(function(){"amqp"===typeField.value&&syncAmqpUrl()})),document.querySelectorAll(".ih-amqp-sync").forEach((function(el){el.addEventListener("input",syncAmqpUrl)})),updateUiForType(),"amqp"===typeField.value&&syncAmqpUrl())}catch(e){Notification.exception(e)}try{const elStatus=document.getElementById("ih-chart-status");if("undefined"!=typeof Chart&&elStatus){const ctxStatus=elStatus.getContext("2d");new Chart(ctxStatus,{type:"doughnut",data:{labels:[strings.success,strings.failure],datasets:[{data:[data.success||0,data.fail||0],backgroundColor:["#198754","#dc3545"]}]},options:{responsive:!0,maintainAspectRatio:!1}})}const elLatency=document.getElementById("ih-chart-latency");if("undefined"!=typeof Chart&&elLatency){const ctxLatency=elLatency.getContext("2d");data.labels&&0!==data.labels.length?new Chart(ctxLatency,{type:"line",data:{labels:data.labels,datasets:[{label:strings.avglatency,data:data.latency,borderColor:"#0d6efd",backgroundColor:"rgba(13,110,253,0.1)",tension:.3,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1}}):(ctxLatency.font="14px sans-serif",ctxLatency.fillStyle="#6c757d",ctxLatency.textAlign="center",ctxLatency.fillText("No latency data available yet",elLatency.width/2,elLatency.height/2))}}catch(e){Notification.exception(e)}}}}));

//# sourceMappingURL=dashboard.min.js.map